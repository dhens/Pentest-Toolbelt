#!/usr/bin/env python3

import socket

HOST = '0.0.0.0' # CHANGE THIS
PORT = 64442     # CHANGE THIS

# Created socket obj where AF_INET is IPv4
# and SOCK_STREAM means we communicate with TCP
with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
    # bind() is used to associate the socket with a specific
    # network interface and port number
    sock.bind((HOST, PORT))
    # Being listening for a remote connection
    sock.listen()
    print('Listening for new connections...')
    conn, addr = sock.accept()
    # When connection occurs
    with conn:
        print('[+] Connection receieved', addr)
        while True:
            command = input('# ').encode()

            # if no data is entered, restart at the while loop
            if (command == ''):
                sock.sendall(b'nodata')
            else:
                conn.sendall(command)

            # setting to 8192+ allows more data to be returned
            # setting below that will often cause early termination of long terminal outputs
            # may need to be set higher one pictures start being sent
            data = conn.recv(8192)
            print(data.decode('utf-8'))
            if not data:
                continue
